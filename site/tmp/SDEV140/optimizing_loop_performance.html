<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SDEV140: Optimizing Loop Performance</title>
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./../assets/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./../assets/images/favicon-16x16.png"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Arimo:ital,wght@0,400;0,700;1,400;1,700&family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap"
      rel="stylesheet"
    />
    <script src="./../assets/scripts/code_snippets.js" defer></script>
    <script src="./../assets/scripts/focus_content.js" defer></script>
    <script src="./../assets/scripts/table_of_contents.js" defer></script>

    <!-- Bootstrap / Sass -->
    <link rel="stylesheet" href="./../assets/css/styles.css" />
    <link rel="stylesheet" href="./../assets/css/bootstrap-icons.css" />
    <script src="./../assets/scripts/bootstrap.bundle.min.js" defer></script>
  </head>
  <body class="bg-light">
    <div class="content-wrapper">
      <div class="toc"></div>

      <h1 id="optimizing-loop-performance">Optimizing Loop Performance</h1>
      <h2 id="performance-analysis">Performance Analysis</h2>
      <p>
        We can use <strong>Big O notation</strong> to analyze the performance of
        algorithms.
      </p>
      <p>We say that a loop runs through <code>n</code> iterations, so...</p>
      <ul>
        <li>
          A single loop that runs through <code>n</code> iterations has a time
          complexity of <code>O(n)</code>.
        </li>
        <li>
          A nested loop that runs through <code>n</code> iterations has a time
          complexity of <code>O(n^2)</code>.
        </li>
      </ul>
      <h2 id="strategies">Strategies</h2>
      <ul>
        <li>Short circuit compound conditions</li>
        <li>Minimize the number of iterations.</li>
        <li>Reduce the amount of work done in each iteration.</li>
      </ul>
      <h3 id="example-most-common-outcomes-first">
        Example: Most Common Outcomes First
      </h3>
      <p>
        If you have an <code>and</code> or <code>or</code> condition, and you
        know that one of the conditions is likely or unlikely, put the outcome
        first that will reduce the number of comparisons.
      </p>
      <p>Remember your truth tables:</p>
      <ul>
        <li>
          <code>and</code>: if we hit a false, the second half doesn&#39;t need
          to be checked
        </li>
        <li>
          <code>or</code>: if we hit a true, the second half doesn&#39;t need to
          be checked
        </li>
      </ul>
      <div class="focusContent demo">
        <p>
          In this example we give special achievement awards to elementary
          students who have an A+ grade and perfect attendance.
        </p>
        <p>
          Most students don&#39;t have an A+ grade, so check that first.
          Programming languages are written so that they won&#39;t check
          &quot;perfect attendance&quot; unless the student has an A+.
        </p>
        <pre
          class="shiki shiki-themes one-light one-dark-pro"
          style="
            background-color: #fafafa;
            --shiki-dark-bg: #282c34;
            color: #383a42;
            --shiki-dark: #abb2bf;
          "
          tabindex="0"
        ><code><span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">grade </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> int</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#0184BC;--shiki-dark:#56B6C2">input</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">"Enter your grade (0-100): "</span><span style="color:#383A42;--shiki-dark:#ABB2BF">))</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">perfect_attendance </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> input</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">"Did you have perfect attendance? (y/n): "</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#383A42;--shiki-dark:#56B6C2">==</span><span style="color:#50A14F;--shiki-dark:#98C379"> "y"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">if</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> grade </span><span style="color:#383A42;--shiki-dark:#56B6C2">>=</span><span style="color:#986801;--shiki-dark:#D19A66"> 98</span><span style="color:#A626A4;--shiki-dark:#C678DD"> and</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> perfect_attendance:</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">    print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">"You get a special achievement award!</span></span></code></pre>
      </div>

      <div class="focusContent demo">
        <p>
          In this example users are prompted to reset the password if it&#39;s
          past the expiration date or if a &quot;force reset&quot; flag is set
          by an administrator.
        </p>
        <p>
          In most cases it will be the expiration date that triggers the
          password reset, so check that first.
        </p>
        <pre
          class="shiki shiki-themes one-light one-dark-pro"
          style="
            background-color: #fafafa;
            --shiki-dark-bg: #282c34;
            color: #383a42;
            --shiki-dark: #abb2bf;
          "
          tabindex="0"
        ><code><span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">password_expired </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> input</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">"Has your password expired? (y/n): "</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#383A42;--shiki-dark:#56B6C2">==</span><span style="color:#50A14F;--shiki-dark:#98C379"> "y"</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">force_reset </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> input</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">"Was your password reset by an administrator? (y/n): "</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#383A42;--shiki-dark:#56B6C2">==</span><span style="color:#50A14F;--shiki-dark:#98C379"> "y"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">if</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> password_expired </span><span style="color:#A626A4;--shiki-dark:#C678DD">or</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> force_reset:</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">    print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">"You must reset your password."</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span></code></pre>
      </div>

      <h3 id="example-quit-while-youre-ahead">
        Example: Quit While You're Ahead
      </h3>
      <p>
        If there&#39;s no need to continue iterating, then exit the loop early.
      </p>
      <div class="focusContent demo">
        <p>
          Here&#39;s a program that searches for a value in a list. Once we find
          the value, we can quit early.
        </p>
        <p>
          Let&#39;s try searching for &#39;d&#39;, then for &#39;Z&#39;. How
          many iterations does each take?
        </p>
        <pre
          class="shiki shiki-themes one-light one-dark-pro"
          style="
            background-color: #fafafa;
            --shiki-dark-bg: #282c34;
            color: #383a42;
            --shiki-dark: #abb2bf;
          "
          tabindex="0"
        ><code><span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># We usually use -1 to indicate "not found"</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">found_index </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#383A42;--shiki-dark:#56B6C2"> -</span><span style="color:#986801;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">search_string </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#50A14F;--shiki-dark:#98C379"> "Super duper really long string that we don't want to search all the way through."</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">search_value </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> input</span><span style="color:#383A42;--shiki-dark:#ABB2BF">( </span><span style="color:#50A14F;--shiki-dark:#98C379">"Enter the letter to search for: "</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">for</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> letter </span><span style="color:#A626A4;--shiki-dark:#C678DD">in</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> search_string:</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    if</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> letter </span><span style="color:#383A42;--shiki-dark:#56B6C2">==</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> search_value:</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">        found_index </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> search_string.</span><span style="color:#383A42;--shiki-dark:#61AFEF">index</span><span style="color:#383A42;--shiki-dark:#ABB2BF">( letter )</span></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">        # We can quit early because we found the value</span></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">        # What happens if we remove the break statement?</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">        break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">( </span><span style="color:#A626A4;--shiki-dark:#C678DD">f</span><span style="color:#50A14F;--shiki-dark:#98C379">"Found </span><span style="color:#986801;--shiki-dark:#D19A66">{</span><span style="color:#383A42;--shiki-dark:#ABB2BF">search_value</span><span style="color:#986801;--shiki-dark:#D19A66">}</span><span style="color:#50A14F;--shiki-dark:#98C379"> at index </span><span style="color:#986801;--shiki-dark:#D19A66">{</span><span style="color:#383A42;--shiki-dark:#ABB2BF">found_index</span><span style="color:#986801;--shiki-dark:#D19A66">}</span><span style="color:#50A14F;--shiki-dark:#98C379">"</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> )</span></span></code></pre>
      </div>

      <h2 id="example-dont-work-harder-work-smarter">
        Example: Don't Work Harder, Work Smarter...
      </h2>
      <p>
        If you can do an operation outside the loop instead of inside, then do
        it outside.
      </p>
      <div class="focusContent demo">
        <p>
          Let&#39;s say we have a program that fetches item quantities from a
          database, then calculates prices based on the quantities.
        </p>
        <p>
          In the examples below we&#39;re just using dummy data, so we&#39;re
          not concerned about the actual results. We&#39;re only concerned with
          the number of operations being performed.
        </p>
        <p>
          Both programs will get the correct results, but one is better than the
          other.
        </p>
        <p><strong>Version 1 - Inefficient:</strong></p>
        <pre
          class="shiki shiki-themes one-light one-dark-pro"
          style="
            background-color: #fafafa;
            --shiki-dark-bg: #282c34;
            color: #383a42;
            --shiki-dark: #abb2bf;
          "
          tabindex="0"
        ><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">import</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">def</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> get_quantity</span><span style="color:#383A42;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    # Simulating a slow database call</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    time.</span><span style="color:#383A42;--shiki-dark:#61AFEF">sleep</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#986801;--shiki-dark:#D19A66">0.1</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    return</span><span style="color:#986801;--shiki-dark:#D19A66"> 5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># Calculate prices for 5 items</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">for</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> item </span><span style="color:#A626A4;--shiki-dark:#C678DD">in</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> range</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#986801;--shiki-dark:#D19A66">5</span><span style="color:#383A42;--shiki-dark:#ABB2BF">):</span></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    # We're fetching the same quantity multiple times unnecessarily</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    qty </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#383A42;--shiki-dark:#61AFEF"> get_quantity</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    price </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> qty </span><span style="color:#383A42;--shiki-dark:#56B6C2">*</span><span style="color:#986801;--shiki-dark:#D19A66"> 10</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">    print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#A626A4;--shiki-dark:#C678DD">f</span><span style="color:#50A14F;--shiki-dark:#98C379">"Item </span><span style="color:#986801;--shiki-dark:#D19A66">{</span><span style="color:#383A42;--shiki-dark:#ABB2BF">item</span><span style="color:#986801;--shiki-dark:#D19A66">}</span><span style="color:#50A14F;--shiki-dark:#98C379">: $</span><span style="color:#986801;--shiki-dark:#D19A66">{</span><span style="color:#383A42;--shiki-dark:#ABB2BF">price</span><span style="color:#986801;--shiki-dark:#D19A66">}</span><span style="color:#50A14F;--shiki-dark:#98C379">"</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span></code></pre>
        <p><strong>Version 2 - Optimized:</strong></p>
        <pre
          class="shiki shiki-themes one-light one-dark-pro"
          style="
            background-color: #fafafa;
            --shiki-dark-bg: #282c34;
            color: #383a42;
            --shiki-dark: #abb2bf;
          "
          tabindex="0"
        ><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">import</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">def</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> get_quantity</span><span style="color:#383A42;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    # Simulating a slow database call</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    time.</span><span style="color:#383A42;--shiki-dark:#61AFEF">sleep</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#986801;--shiki-dark:#D19A66">0.1</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    return</span><span style="color:#986801;--shiki-dark:#D19A66"> 5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># Fetch quantity once, outside the loop</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">qty </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#383A42;--shiki-dark:#61AFEF"> get_quantity</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># Calculate prices for 5 items</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">for</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> item </span><span style="color:#A626A4;--shiki-dark:#C678DD">in</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> range</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#986801;--shiki-dark:#D19A66">5</span><span style="color:#383A42;--shiki-dark:#ABB2BF">):</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    price </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> qty </span><span style="color:#383A42;--shiki-dark:#56B6C2">*</span><span style="color:#986801;--shiki-dark:#D19A66"> 10</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">    print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#A626A4;--shiki-dark:#C678DD">f</span><span style="color:#50A14F;--shiki-dark:#98C379">"Item </span><span style="color:#986801;--shiki-dark:#D19A66">{</span><span style="color:#383A42;--shiki-dark:#ABB2BF">item</span><span style="color:#986801;--shiki-dark:#D19A66">}</span><span style="color:#50A14F;--shiki-dark:#98C379">: $</span><span style="color:#986801;--shiki-dark:#D19A66">{</span><span style="color:#383A42;--shiki-dark:#ABB2BF">price</span><span style="color:#986801;--shiki-dark:#D19A66">}</span><span style="color:#50A14F;--shiki-dark:#98C379">"</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span></code></pre>
        <p>
          In Version 1, we make 5 database calls (one per item). In Version 2,
          we make only 1 database call.
        </p>
        <p>If each database call takes 0.1 seconds:</p>
        <ul>
          <li>Version 1 takes: 0.5 seconds (5 calls)</li>
          <li>Version 2 takes: 0.1 seconds (1 call)</li>
        </ul>
        <p>This is a common optimization pattern:</p>
        <ol>
          <li>Identify operations that don&#39;t need to be repeated</li>
          <li>Move them outside the loop</li>
          <li>Store the results in variables</li>
          <li>Use the stored results inside the loop</li>
        </ol>
      </div>

      <h2 id="premature-optimization">Premature Optimization</h2>
      <p>
        Having gone through these strategies, you might be tempted to optimize
        every part of your code...
      </p>
      <p>
        <span
          style="
            font-size: 2em;
            color: red;
            font-weight: bold;
            text-transform: uppercase;
            text-decoration: underline;
            background-color: yellow;
            padding: 10px;
            border: 5px dashed red;
          "
          ><strong>DON&#39;T DO IT.</strong></span
        >
      </p>
      <p>
        <strong
          >You should only optimize code that is causing performance
          issues.</strong
        >
      </p>
      <p>
        In almost all cases, a focus on code clarity and readability will
        produce a more maintainable program that performs better.
      </p>
      <p>
        When in doubt: <strong>measure.</strong> Is your &quot;improvement&quot;
        actually an improvement?
      </p>
      <h3 id="measuring-performance">Measuring Performance</h3>
      <p>
        Later in your career you may consider using performance analysis
        techniques to identify bottlenecks in your code.
      </p>
      <ul>
        <li>Log files</li>
        <li>Timers</li>
        <li>Memory / CPU / Network usage</li>
        <li>
          Profilers that track execution paths (e.g. find number of times a
          function is called)
        </li>
      </ul>
    </div>
  </body>
</html>
