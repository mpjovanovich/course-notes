<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SDEV140: Call Stack and Variable Scope</title>
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./../assets/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./../assets/images/favicon-16x16.png"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Arimo:ital,wght@0,400;0,700;1,400;1,700&family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap"
      rel="stylesheet"
    />
    <script src="./../assets/scripts/code_snippets.js" defer></script>
    <script src="./../assets/scripts/focus_content.js" defer></script>
    <script src="./../assets/scripts/table_of_contents.js" defer></script>

    <!-- Bootstrap / Sass -->
    <link rel="stylesheet" href="./../assets/css/styles.css" />
    <link rel="stylesheet" href="./../assets/css/bootstrap-icons.css" />
    <script src="./../assets/scripts/bootstrap.bundle.min.js" defer></script>
  </head>
  <body class="bg-light">
    <div class="content-wrapper">
      <div class="toc">
        <ul>
          <li>
            <a href="#the-call-stack">The Call Stack</a>
            <ul>
              <li><a href="#stack-data-structure">Stack Data Structure</a></li>
              <li><a href="#stack-frames">Stack Frames</a></li>
              <li><a href="#call-stack">Call Stack</a></li>
            </ul>
          </li>
          <li>
            <a href="#variable-scope">Variable Scope</a>
            <ul>
              <li><a href="#global-scope">Global Scope</a></li>
              <li><a href="#function-scope">Function Scope</a></li>
              <li><a href="#scope-examples">Scope Examples</a></li>
            </ul>
          </li>
        </ul>
      </div>

      <h1 id="the-call-stack">The Call Stack</h1>
      <p>The <strong>call stack</strong>:</p>
      <ul>
        <li>Keeps track of the sequence of function calls in a program</li>
        <li>Is composed of stack frames</li>
        <li>Exists for the lifetime of a program</li>
      </ul>
      <h2 id="stack-data-structure">Stack Data Structure</h2>
      <p>
        A <strong>stack</strong> is a LIFO (last in, first out) data structure.
      </p>
      <p>
        It&#39;s like laying down a stack of cards. You can only add or remove
        cards from the top of the stack.
      </p>
      <figure>
        <span>
          <img
            src="https://miro.medium.com/v2/resize:fit:640/1*lb-0r80YYhcnoVcQ3HY-1g.gif"
            style=""
          />
        </span>
        <figcaption>
          <a
            href="https://medium.com/@todoroski97/data-structure-stack-17b80ed3bfa9"
            >The Stack Data Structure</a
          >
        </figcaption>
      </figure>

      <h2 id="stack-frames">Stack Frames</h2>
      <p>
        A <strong>stack frame</strong> is a data structure that contains all
        relevant information that&#39;s needed to execute a function. It&#39;s
        much like a snapshot of all of the data about a function at a given
        point in time.
      </p>
      <p>
        The <strong>execution context</strong> is the stack frame that&#39;s
        currently being executed. The computer only &quot;pays attention&quot;
        to the current execution context, and knows nothing about the other
        stack frames.
      </p>
      <p>
        For a simple program with no functions (we would typically call this a
        <strong>script</strong>), the call stack only has one stack frame.
        It&#39;s typically called the <strong>global script</strong> when
        referring to it.
      </p>
      <h2 id="call-stack">Call Stack</h2>
      <p>
        When a program calls a function, a new stack frame is created for that
        function call and <strong>pushed</strong> onto the top of the call
        stack. The execution context is then switched to the new stack frame.
        Each function operates as if it is its own program.
      </p>
      <p><em>Example:</em></p>
      <p>For the following program:</p>
      <pre
        class="shiki shiki-themes one-light one-dark-pro"
        style="
          background-color: #fafafa;
          --shiki-dark-bg: #282c34;
          color: #383a42;
          --shiki-dark: #abb2bf;
        "
        tabindex="0"
      ><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">def</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> greet</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#986801;font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic">name</span><span style="color:#383A42;--shiki-dark:#ABB2BF">):</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    message </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#A626A4;--shiki-dark:#C678DD"> f</span><span style="color:#50A14F;--shiki-dark:#98C379">"Hello, </span><span style="color:#986801;--shiki-dark:#D19A66">{</span><span style="color:#383A42;--shiki-dark:#ABB2BF">name</span><span style="color:#986801;--shiki-dark:#D19A66">}</span><span style="color:#50A14F;--shiki-dark:#98C379">!"</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    return</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> message</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">def</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> main</span><span style="color:#383A42;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    user </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#50A14F;--shiki-dark:#98C379"> "Alice"</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    result </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#383A42;--shiki-dark:#61AFEF"> greet</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(user)</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">    print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(result)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#61AFEF">main</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()</span></span></code></pre>
      <p>The call stack would look like this:</p>
      <pre
        class="shiki shiki-themes one-light one-dark-pro"
        style="
          background-color: #fafafa;
          --shiki-dark-bg: #282c34;
          color: #383a42;
          --shiki-dark: #abb2bf;
        "
        tabindex="0"
      ><code><span class="line"><span>3. greet(name="Alice")     &#x3C;- Current execution context</span></span>
<span class="line"><span>2. main()</span></span>
<span class="line"><span>1. Global script</span></span></code></pre>
      <p>
        Let&#39;s try it in VS Code. Run the program, and then open the call
        stack in the debugger...
      </p>
      <div class="focusContent note">
        <p>
          A <strong>stack overflow</strong> occurs when the call stack grows too
          large, and the program runs out of memory.
        </p>
        <p>
          This is usually caused by a recursive function that calls itself
          without a base case (i.e., a condition to stop the recursion).
        </p>
        <p><strong>Try it out!</strong></p>
        <p>Run this for a stack overflow, on the house:</p>
        <pre
          class="shiki shiki-themes one-light one-dark-pro"
          style="
            background-color: #fafafa;
            --shiki-dark-bg: #282c34;
            color: #383a42;
            --shiki-dark: #abb2bf;
          "
          tabindex="0"
        ><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">def</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> infinite_recursion</span><span style="color:#383A42;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#61AFEF">    infinite_recursion</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#61AFEF">infinite_recursion</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()</span></span></code></pre>
      </div>

      <h1 id="variable-scope">Variable Scope</h1>
      <p>
        <strong>Scope</strong> is the region of a program where a variable is
        accessible. In Python, there are two types of scope:
      </p>
      <ul>
        <li>
          <strong>Global scope</strong>: accessible everywhere in the program
        </li>
        <li>
          <strong>Function scope</strong>: accessible only within the function
          where it&#39;s defined
        </li>
      </ul>
      <h2 id="global-scope">Global Scope</h2>
      <p>
        Variables defined outside of any function are called
        <strong>global variables</strong>. They are accessible everywhere in the
        program, even within functions.
      </p>
      <p>
        In general, global variables should be used sparingly. You might use a
        global variable if you have a read only constant value that is used in
        many places in your program:
      </p>
      <pre
        class="shiki shiki-themes one-light one-dark-pro"
        style="
          background-color: #fafafa;
          --shiki-dark-bg: #282c34;
          color: #383a42;
          --shiki-dark: #abb2bf;
        "
        tabindex="0"
      ><code><span class="line"><span style="color:#383A42;--shiki-dark:#D19A66">PROGRAM_CODE</span><span style="color:#383A42;--shiki-dark:#56B6C2"> =</span><span style="color:#50A14F;--shiki-dark:#98C379"> "SDEV140"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># Program code is used here...</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">def</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> print_student_record</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#986801;font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic">student_id</span><span style="color:#383A42;--shiki-dark:#ABB2BF">):</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">    print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#A626A4;--shiki-dark:#C678DD">f</span><span style="color:#50A14F;--shiki-dark:#98C379">"Student ID: </span><span style="color:#986801;--shiki-dark:#D19A66">{</span><span style="color:#383A42;--shiki-dark:#ABB2BF">student_id</span><span style="color:#986801;--shiki-dark:#D19A66">}</span><span style="color:#50A14F;--shiki-dark:#98C379">, Program: </span><span style="color:#986801;--shiki-dark:#D19A66">{</span><span style="color:#383A42;--shiki-dark:#D19A66">PROGRAM_CODE</span><span style="color:#986801;--shiki-dark:#D19A66">}</span><span style="color:#50A14F;--shiki-dark:#98C379">"</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># and here...</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">def</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> print_course_info</span><span style="color:#383A42;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">    print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#A626A4;--shiki-dark:#C678DD">f</span><span style="color:#50A14F;--shiki-dark:#98C379">"Course Code: </span><span style="color:#986801;--shiki-dark:#D19A66">{</span><span style="color:#383A42;--shiki-dark:#D19A66">PROGRAM_CODE</span><span style="color:#986801;--shiki-dark:#D19A66">}</span><span style="color:#50A14F;--shiki-dark:#98C379">"</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#61AFEF">print_student_record</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">"A12345"</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#61AFEF">print_course_info</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()</span></span></code></pre>
      <h2 id="function-scope">Function Scope</h2>
      <p>
        More typically, any variable that needs to be used within a function is
        either:
      </p>
      <ul>
        <li>Passed in as a parameter</li>
        <li>Created within the function</li>
      </ul>
      <p>
        These variables are called <strong>local variables</strong>. They are
        only accessible within the function where they are defined.
      </p>
      <p>
        This is because they are part of the function&#39;s stack frame, and are
        not accessible outside of that frame.
      </p>
      <h2 id="scope-examples">Scope Examples</h2>
      <div class="focusContent lookout">
        <p>
          Trying to access a local variable outside of its function will cause
          an error.
        </p>
        <pre
          class="shiki shiki-themes one-light one-dark-pro"
          style="
            background-color: #fafafa;
            --shiki-dark-bg: #282c34;
            color: #383a42;
            --shiki-dark: #abb2bf;
          "
          tabindex="0"
        ><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">def</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> print_name</span><span style="color:#383A42;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    name </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#50A14F;--shiki-dark:#98C379"> "Alice"</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">    print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(name)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">## This works fine...</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#61AFEF">print_name</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">## This will cause an error - name only exists within the function</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(name)</span></span></code></pre>
      </div>

      <div class="focusContent lookout">
        <p>
          Updating a local variable will not affect the value of a variable that
          was passed in.
        </p>
        <p>
          <strong
            ><em
              >The function creates its own local variable, which is a copy of
              the value passed in</em
            ></strong
          >. Updating this local variable does not affect the value of the
          variable that was passed in.
        </p>
        <p>
          Take a look at the Stack Trace in the VS Code debugger to see how this
          works.
        </p>
        <pre
          class="shiki shiki-themes one-light one-dark-pro"
          style="
            background-color: #fafafa;
            --shiki-dark-bg: #282c34;
            color: #383a42;
            --shiki-dark: #abb2bf;
          "
          tabindex="0"
        ><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">def</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> update_name</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#986801;font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic">name</span><span style="color:#383A42;--shiki-dark:#ABB2BF">):</span></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    # This "name" is actually a completely new local variable with no connection</span></span>
<span class="line"><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    # to the name variable in the outer scope</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    name </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> name.</span><span style="color:#383A42;--shiki-dark:#61AFEF">upper</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">    print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(name)  </span><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># ALICE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">name </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#50A14F;--shiki-dark:#98C379"> "Alice"</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(name)  </span><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># Alice</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#61AFEF">update_name</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(name)</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(name)  </span><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># Alice</span></span></code></pre>
      </div>

      <div class="focusContent example">
        <p>
          If we want to modify the value of a variable that was passed in and
          access it later, we do so by returning the modified value.
        </p>
        <pre
          class="shiki shiki-themes one-light one-dark-pro"
          style="
            background-color: #fafafa;
            --shiki-dark-bg: #282c34;
            color: #383a42;
            --shiki-dark: #abb2bf;
          "
          tabindex="0"
        ><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">def</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> update_name</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#986801;font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic">name</span><span style="color:#383A42;--shiki-dark:#ABB2BF">):</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    name </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> name.</span><span style="color:#383A42;--shiki-dark:#61AFEF">upper</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    return</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">name </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#50A14F;--shiki-dark:#98C379"> "Alice"</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">name </span><span style="color:#383A42;--shiki-dark:#56B6C2">=</span><span style="color:#383A42;--shiki-dark:#61AFEF"> update_name</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(name)</span></span>
<span class="line"><span style="color:#0184BC;--shiki-dark:#56B6C2">print</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(name)  </span><span style="color:#A0A1A7;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># ALICE</span></span></code></pre>
      </div>
    </div>
  </body>
</html>
